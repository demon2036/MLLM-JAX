# Default config for `scripts/run_grpo_gsm8k_training.py`.
#
# Notes:
# - Keep secrets (WANDB_API_KEY) in `.env` (gitignored); do NOT put secrets here.
# - Values can reference env vars like `$MODEL_PATH`, but prefer explicit values for reproducibility.

model_path: Qwen/Qwen2.5-7B-Instruct

steps: 20

# Rollout (generation) config.
rollout:
  # Rollout backend selector (swappable generation engine).
  # - naive: current in-process sampler
  # - future: vllm, ...
  backend: naive
  # Batch sizes are expressed in "sequences" (one sequence = one (prompt, completion) sample).
  #
  # Only ONE of these needs to be set; others are derived at runtime:
  # - batch_size: global sequences per training step (across all processes)
  # - batch_size_per_process: sequences per step per process
  # - batch_size_per_device: sequences per step per device
  batch_size: null
  batch_size_per_process: null
  batch_size_per_device: null
  # Optional: prompts per rollout pass (KV-cache footprint control).
  # If unset, runner derives a value from batch targets and `process_count`.
  prompts_per_pass_per_process: 32
  prompts_per_pass_per_device: null
  # Number of samples per prompt (GRPO group size, a.k.a. K).
  n: 1
  global_length: 512
  max_length_sample: 1024

# Train (update) config.
train:
  # If set, split the rollout batch into smaller micro-batches for the update step.
  # This lets rollout be larger than the per-update memory limit.
  global_micro_batch_size: null
  micro_batch_size_per_process: 4
  micro_batch_size_per_device: null
  ppo_epochs: 1
  beta: 0.0

# Mesh axis names are ('dp','fsdp','tp') in `MLLM_JAX.utils.get_jax_mesh2`.
# v4-16 (2-host, megacore) usually has global `device_count=8`; this shape uses pure FSDP:
mesh_shape: 1,-1,1

wandb_project: mllm-jax-grpo-gsm8k
# If null, entrypoint uses an auto name with timestamp.
wandb_name: null

# reward_correct, reward_format, tag_count_reward
reward_weights: [1.0, 0.5, 0.5]

# Optional eval (rollout + reward only; no parameter updates)
eval_every_steps: 0
eval_batches_per_process: 1
eval_split: test
