backend: tpu
# Official MiniOneRec Office checkpoint (HF repo subfolder).
# Download it first (e.g. on TPU): `huggingface_hub.snapshot_download(... allow_patterns=["Office_ckpt/*"] ...)`
base_model: workdir/hf_ckpts/kkknight_MiniOneRec/Office_ckpt
output_dir: runs/sid_sft_jax_eval_official_minionerec_office_ckpt_fixedprefill
seed: 42
device: tpu

jax:
  mesh_shape: "auto"
  param_dtype: bfloat16
  compute_dtype: bfloat16
  max_cache_length: 512

data:
  category: Office_Products
  train_file: workdir/MiniOneRec/data/Amazon/train/Office_Products_5_2016-10-2018-11.csv
  eval_file: workdir/MiniOneRec/data/Amazon/valid/Office_Products_5_2016-10-2018-11.csv
  test_file: workdir/MiniOneRec/data/Amazon/test/Office_Products_5_2016-10-2018-11.csv
  info_file: workdir/MiniOneRec/data/Amazon/info/Office_Products_5_2016-10-2018-11.txt
  sid_index_path: workdir/MiniOneRec/data/Amazon/index/Office_Products.index.json
  item_meta_path: workdir/MiniOneRec/data/Amazon/index/Office_Products.item.json
  max_len: 512
  sample_train: -1
  sample_eval: -1
  sample_test: -1

tasks:
  sid_next_item: true
  sid_item_alignment: true
  fusion_seq_rec: true

train:
  per_device_train_batch_size: 16
  per_device_eval_batch_size: 1
  global_batch_size: 1024
  learning_rate: 0.0003
  optimizer: adamw
  weight_decay: 0.0
  num_train_epochs: 10
  max_steps: -1
  warmup_steps: 0
  logging_steps: 1
  eval_steps: 0
  save_steps: 0
  save_total_limit: 0
  save_last: false
  group_by_length: false
  freeze_LLM: false
  train_from_scratch: false
  resume_from_checkpoint: null
  early_stopping_patience: 0
  bf16: false
  fp16: false

eval:
  enabled: true
  batch_size: 2
  num_beams: 50
  max_new_tokens: 32
  length_penalty: 0.0
  topk: [1, 3, 5, 10, 20, 50]
  constrained: true
  save_predictions_json: true
  # Avoid multi-bucket JIT compiles: pad all prompts to a single fixed prefill length.
  prefill_mode: fixed
  fixed_prefill_len: null

wandb:
  project: minionerec-sid-sft
  mode: online
  name: null

